# -*- coding: utf-8 -*-
# @Time    : 2020/8/24 13:01
# @Author  : Haijun

from pathlib import Path
from typing import Optional
from dynaconf import settings, loaders
from lib.base_fun import logger

REDIS_HOST = '127.0.0.1'
REDIS_PORT = 6379
REDIS_DB = 4
REDIS_PASSWD = ""
MYSQL_HOST = "127.0.0.1"
MYSQL_USER = "root"
MYSQL_PASSWD = "root"
MYSQL_DATABASE = ""
MYSQL_PORT = 3306

DEFAULT_PATH = "settings.toml"
BASE_SETTINGS = {
    "HOME_DIR": str(Path().absolute()),
    "REDIS": {
        "HOST": REDIS_HOST,
        "PORT": REDIS_PORT,
        "DB": REDIS_DB,
        "PASSWD": REDIS_PASSWD
    },
    "MYSQL": {
        "HOST": MYSQL_HOST,
        "USER": MYSQL_USER,
        "PASSWD": MYSQL_PASSWD,
        "DATABASE": MYSQL_DATABASE,
        "PORT": MYSQL_PORT
    },
    'AMAZON_GOODS': 'amazon_goods',  # 保存数据到redis的key
    'AMAZON_LIST_URL': 'amazon_list_url',  # 保存数据到redis的key
    'AMAZON_LIST_URL_BAK': 'amazon_list_url_bak',
    'PROXY_USER': '',  # 代理用户名
    'PROXY_PWD': '',  # 代理密码
    "AE_COOKIE": [
        'session-id=132-9001681-2923327; i18n-prefs=USD; sp-cdn="L5Z9:CN"; skin=noskin; ubid-main=130-8020860-9388951; ld=AZUSSOA-sell; s_pers=%20s_fid%3D0CEC3543AD2E8239-30843AE20A6D66F7%7C1783221604392%3B%20s_dl%3D1%7C1625457004395%3B%20gpv_page%3DUS%253AAZ%253ASOA-overview-sell%7C1625457004403%3B%20s_ev15%3D%255B%255B%2527AZUSSOA-sell%2527%252C%25271625455204407%2527%255D%255D%7C1783221604407%3B; s_sess=%20s_ppvl%3D%3B%20s_cc%3Dtrue%3B%20c_m%3DAZUSSOA-sellundefinedAmazon.comundefined%3B%20s_sq%3Damznsrvsglobalprod%25252Camznsrvsmainprod%25252Camznsrvsprod%25252Camznsrvsglobalprodbotfilter%253D%252526pid%25253DUS%2525253AAZ%2525253ASOA-overview-sell%252526pidt%25253D1%252526oid%25253Dhttps%2525253A%2525252F%2525252Fwww.amazon.com%2525252Finternational-sales-offers%2525252Fb%2525252F%2525253Fie%2525253DUTF8%25252526node%2525253D15529609011%25252526ref_%2525253Dnav_cs_gb_intl_52%252526ot%25253DA%3B%20s_ppv%3DUS%25253AAZ%25253ASOA-overview-sell%252C19%252C19%252C1010%252C2048%252C1010%252C2048%252C1152%252C1.25%252CL%3B; sst-main=Sst1|PQFfbMXtmmOtLWV6-rbZz7iKCVS30_oVcjYeVn9_6JEEZHoVfPA3UguhISRslhNtsyJNU5rO_lXhokZPnREX39uBUx526KDk6zMBHHVjDmLq9WnvOll7B59vGfMjvzO_TQEyLtkEyigtHVibBgGp9TEgCYHQ9iEhQU11Dw26wl6off1ZW_sl5K90cUtbMFzpeAAVChYZlfGqgHFndxgadeDPXh0BF_GQ7qGtVo3XjYQq8jVRgW8Ddoyjh8ruU0qV4YM-2eUA58LCH5KXLu3dGizQYEY5j0K1rIjlv4GXy18fxE0; session-token=0y/hsq8rLQ6Z36B91LbYPAVmxsMT66VgqRM7z0sK9IdREQViHX37xVjNVw3zd+M217ZJwSoU3OcHKnL9I7G5MATEs4CEw05rkasXbShCXGMOerO2L7M+nASDqJaU3MegCKLlzGSICS/e6Ws7H0GLplib2BWDE6179XvHSEVJBjXpQmhqkbSy+LN3+5UEwv8kHQ+JBL4GN1e/K/S6V0lHtt/PfVGBgQZ2Tpv6IWHOnA/QuPaSNsgDq+9dHDYTjg8u; session-id-time=2082787201l; csm-hit=tb:s-XHHJG7RGC881XTPDXZWV|1625471968328&t:1625471968831&adb:adblk_yes',
        'session-id=132-9001681-2923327; i18n-prefs=USD; sp-cdn="L5Z9:CN"; skin=noskin; ubid-main=130-8020860-9388951; ld=AZUSSOA-sell; s_pers=%20s_fid%3D0CEC3543AD2E8239-30843AE20A6D66F7%7C1783221604392%3B%20s_dl%3D1%7C1625457004395%3B%20gpv_page%3DUS%253AAZ%253ASOA-overview-sell%7C1625457004403%3B%20s_ev15%3D%255B%255B%2527AZUSSOA-sell%2527%252C%25271625455204407%2527%255D%255D%7C1783221604407%3B; s_sess=%20s_ppvl%3D%3B%20s_cc%3Dtrue%3B%20c_m%3DAZUSSOA-sellundefinedAmazon.comundefined%3B%20s_sq%3Damznsrvsglobalprod%25252Camznsrvsmainprod%25252Camznsrvsprod%25252Camznsrvsglobalprodbotfilter%253D%252526pid%25253DUS%2525253AAZ%2525253ASOA-overview-sell%252526pidt%25253D1%252526oid%25253Dhttps%2525253A%2525252F%2525252Fwww.amazon.com%2525252Finternational-sales-offers%2525252Fb%2525252F%2525253Fie%2525253DUTF8%25252526node%2525253D15529609011%25252526ref_%2525253Dnav_cs_gb_intl_52%252526ot%25253DA%3B%20s_ppv%3DUS%25253AAZ%25253ASOA-overview-sell%252C19%252C19%252C1010%252C2048%252C1010%252C2048%252C1152%252C1.25%252CL%3B; sst-main=Sst1|PQFfbMXtmmOtLWV6-rbZz7iKCVS30_oVcjYeVn9_6JEEZHoVfPA3UguhISRslhNtsyJNU5rO_lXhokZPnREX39uBUx526KDk6zMBHHVjDmLq9WnvOll7B59vGfMjvzO_TQEyLtkEyigtHVibBgGp9TEgCYHQ9iEhQU11Dw26wl6off1ZW_sl5K90cUtbMFzpeAAVChYZlfGqgHFndxgadeDPXh0BF_GQ7qGtVo3XjYQq8jVRgW8Ddoyjh8ruU0qV4YM-2eUA58LCH5KXLu3dGizQYEY5j0K1rIjlv4GXy18fxE0; session-token=0y/hsq8rLQ6Z36B91LbYPAVmxsMT66VgqRM7z0sK9IdREQViHX37xVjNVw3zd+M217ZJwSoU3OcHKnL9I7G5MATEs4CEw05rkasXbShCXGMOerO2L7M+nASDqJaU3MegCKLlzGSICS/e6Ws7H0GLplib2BWDE6179XvHSEVJBjXpQmhqkbSy+LN3+5UEwv8kHQ+JBL4GN1e/K/S6V0lHtt/PfVGBgQZ2Tpv6IWHOnA/QuPaSNsgDq+9dHDYTjg8u; session-id-time=2082787201l; csm-hit=tb:KVBWNMA5DKRZKKS4P5XZ+s-72AEGSW7NWB70TZN6ZF5|1625472042901&t:1625472042901&adb:adblk_yes',
        'session-id=132-9001681-2923327; i18n-prefs=USD; sp-cdn="L5Z9:CN"; skin=noskin; ubid-main=130-8020860-9388951; ld=AZUSSOA-sell; s_pers=%20s_fid%3D0CEC3543AD2E8239-30843AE20A6D66F7%7C1783221604392%3B%20s_dl%3D1%7C1625457004395%3B%20gpv_page%3DUS%253AAZ%253ASOA-overview-sell%7C1625457004403%3B%20s_ev15%3D%255B%255B%2527AZUSSOA-sell%2527%252C%25271625455204407%2527%255D%255D%7C1783221604407%3B; s_sess=%20s_ppvl%3D%3B%20s_cc%3Dtrue%3B%20c_m%3DAZUSSOA-sellundefinedAmazon.comundefined%3B%20s_sq%3Damznsrvsglobalprod%25252Camznsrvsmainprod%25252Camznsrvsprod%25252Camznsrvsglobalprodbotfilter%253D%252526pid%25253DUS%2525253AAZ%2525253ASOA-overview-sell%252526pidt%25253D1%252526oid%25253Dhttps%2525253A%2525252F%2525252Fwww.amazon.com%2525252Finternational-sales-offers%2525252Fb%2525252F%2525253Fie%2525253DUTF8%25252526node%2525253D15529609011%25252526ref_%2525253Dnav_cs_gb_intl_52%252526ot%25253DA%3B%20s_ppv%3DUS%25253AAZ%25253ASOA-overview-sell%252C19%252C19%252C1010%252C2048%252C1010%252C2048%252C1152%252C1.25%252CL%3B; sst-main=Sst1|PQFfbMXtmmOtLWV6-rbZz7iKCVS30_oVcjYeVn9_6JEEZHoVfPA3UguhISRslhNtsyJNU5rO_lXhokZPnREX39uBUx526KDk6zMBHHVjDmLq9WnvOll7B59vGfMjvzO_TQEyLtkEyigtHVibBgGp9TEgCYHQ9iEhQU11Dw26wl6off1ZW_sl5K90cUtbMFzpeAAVChYZlfGqgHFndxgadeDPXh0BF_GQ7qGtVo3XjYQq8jVRgW8Ddoyjh8ruU0qV4YM-2eUA58LCH5KXLu3dGizQYEY5j0K1rIjlv4GXy18fxE0; session-token=0y/hsq8rLQ6Z36B91LbYPAVmxsMT66VgqRM7z0sK9IdREQViHX37xVjNVw3zd+M217ZJwSoU3OcHKnL9I7G5MATEs4CEw05rkasXbShCXGMOerO2L7M+nASDqJaU3MegCKLlzGSICS/e6Ws7H0GLplib2BWDE6179XvHSEVJBjXpQmhqkbSy+LN3+5UEwv8kHQ+JBL4GN1e/K/S6V0lHtt/PfVGBgQZ2Tpv6IWHOnA/QuPaSNsgDq+9dHDYTjg8u; session-id-time=2082787201l; csm-hit=tb:KVBWNMA5DKRZKKS4P5XZ+s-7GW5VT6DNX4XW5H6MZH9|1625472068378&t:1625472068378&adb:adblk_yes',
        'session-id=132-9001681-2923327; i18n-prefs=USD; sp-cdn="L5Z9:CN"; skin=noskin; ubid-main=130-8020860-9388951; ld=AZUSSOA-sell; s_pers=%20s_fid%3D0CEC3543AD2E8239-30843AE20A6D66F7%7C1783221604392%3B%20s_dl%3D1%7C1625457004395%3B%20gpv_page%3DUS%253AAZ%253ASOA-overview-sell%7C1625457004403%3B%20s_ev15%3D%255B%255B%2527AZUSSOA-sell%2527%252C%25271625455204407%2527%255D%255D%7C1783221604407%3B; s_sess=%20s_ppvl%3D%3B%20s_cc%3Dtrue%3B%20c_m%3DAZUSSOA-sellundefinedAmazon.comundefined%3B%20s_sq%3Damznsrvsglobalprod%25252Camznsrvsmainprod%25252Camznsrvsprod%25252Camznsrvsglobalprodbotfilter%253D%252526pid%25253DUS%2525253AAZ%2525253ASOA-overview-sell%252526pidt%25253D1%252526oid%25253Dhttps%2525253A%2525252F%2525252Fwww.amazon.com%2525252Finternational-sales-offers%2525252Fb%2525252F%2525253Fie%2525253DUTF8%25252526node%2525253D15529609011%25252526ref_%2525253Dnav_cs_gb_intl_52%252526ot%25253DA%3B%20s_ppv%3DUS%25253AAZ%25253ASOA-overview-sell%252C19%252C19%252C1010%252C2048%252C1010%252C2048%252C1152%252C1.25%252CL%3B; sst-main=Sst1|PQFfbMXtmmOtLWV6-rbZz7iKCVS30_oVcjYeVn9_6JEEZHoVfPA3UguhISRslhNtsyJNU5rO_lXhokZPnREX39uBUx526KDk6zMBHHVjDmLq9WnvOll7B59vGfMjvzO_TQEyLtkEyigtHVibBgGp9TEgCYHQ9iEhQU11Dw26wl6off1ZW_sl5K90cUtbMFzpeAAVChYZlfGqgHFndxgadeDPXh0BF_GQ7qGtVo3XjYQq8jVRgW8Ddoyjh8ruU0qV4YM-2eUA58LCH5KXLu3dGizQYEY5j0K1rIjlv4GXy18fxE0; session-token=0y/hsq8rLQ6Z36B91LbYPAVmxsMT66VgqRM7z0sK9IdREQViHX37xVjNVw3zd+M217ZJwSoU3OcHKnL9I7G5MATEs4CEw05rkasXbShCXGMOerO2L7M+nASDqJaU3MegCKLlzGSICS/e6Ws7H0GLplib2BWDE6179XvHSEVJBjXpQmhqkbSy+LN3+5UEwv8kHQ+JBL4GN1e/K/S6V0lHtt/PfVGBgQZ2Tpv6IWHOnA/QuPaSNsgDq+9dHDYTjg8u; session-id-time=2082787201l; csm-hit=tb:KVBWNMA5DKRZKKS4P5XZ+s-AJK0M92Y1YEGHFPVRTRJ|1625472089430&t:1625472089430&adb:adblk_yes',
        'session-id=132-9001681-2923327; i18n-prefs=USD; sp-cdn="L5Z9:CN"; skin=noskin; ubid-main=130-8020860-9388951; ld=AZUSSOA-sell; s_pers=%20s_fid%3D0CEC3543AD2E8239-30843AE20A6D66F7%7C1783221604392%3B%20s_dl%3D1%7C1625457004395%3B%20gpv_page%3DUS%253AAZ%253ASOA-overview-sell%7C1625457004403%3B%20s_ev15%3D%255B%255B%2527AZUSSOA-sell%2527%252C%25271625455204407%2527%255D%255D%7C1783221604407%3B; s_sess=%20s_ppvl%3D%3B%20s_cc%3Dtrue%3B%20c_m%3DAZUSSOA-sellundefinedAmazon.comundefined%3B%20s_sq%3Damznsrvsglobalprod%25252Camznsrvsmainprod%25252Camznsrvsprod%25252Camznsrvsglobalprodbotfilter%253D%252526pid%25253DUS%2525253AAZ%2525253ASOA-overview-sell%252526pidt%25253D1%252526oid%25253Dhttps%2525253A%2525252F%2525252Fwww.amazon.com%2525252Finternational-sales-offers%2525252Fb%2525252F%2525253Fie%2525253DUTF8%25252526node%2525253D15529609011%25252526ref_%2525253Dnav_cs_gb_intl_52%252526ot%25253DA%3B%20s_ppv%3DUS%25253AAZ%25253ASOA-overview-sell%252C19%252C19%252C1010%252C2048%252C1010%252C2048%252C1152%252C1.25%252CL%3B; sst-main=Sst1|PQFfbMXtmmOtLWV6-rbZz7iKCVS30_oVcjYeVn9_6JEEZHoVfPA3UguhISRslhNtsyJNU5rO_lXhokZPnREX39uBUx526KDk6zMBHHVjDmLq9WnvOll7B59vGfMjvzO_TQEyLtkEyigtHVibBgGp9TEgCYHQ9iEhQU11Dw26wl6off1ZW_sl5K90cUtbMFzpeAAVChYZlfGqgHFndxgadeDPXh0BF_GQ7qGtVo3XjYQq8jVRgW8Ddoyjh8ruU0qV4YM-2eUA58LCH5KXLu3dGizQYEY5j0K1rIjlv4GXy18fxE0; session-token=0y/hsq8rLQ6Z36B91LbYPAVmxsMT66VgqRM7z0sK9IdREQViHX37xVjNVw3zd+M217ZJwSoU3OcHKnL9I7G5MATEs4CEw05rkasXbShCXGMOerO2L7M+nASDqJaU3MegCKLlzGSICS/e6Ws7H0GLplib2BWDE6179XvHSEVJBjXpQmhqkbSy+LN3+5UEwv8kHQ+JBL4GN1e/K/S6V0lHtt/PfVGBgQZ2Tpv6IWHOnA/QuPaSNsgDq+9dHDYTjg8u; session-id-time=2082787201l; csm-hit=tb:KVBWNMA5DKRZKKS4P5XZ+s-Z6BXYPG1EC3YDHSG5H43|1625472112347&t:1625472112348&adb:adblk_yes',

    ],
    'SLEEP_TIME': 5  # 休眠时间
}


def load_or_create_settings(path: Optional[str] = ''):
    """
    创建或加载配置文件
    """
    path = path or DEFAULT_PATH
    if not Path(path).exists():
        default_settings_path = str(Path.cwd() / Path(DEFAULT_PATH))
        logger.info(
            f'没有发现配置文件 "{Path(path).absolute()}". '
            f"创建默认配置文件: {default_settings_path}",
        )
        Path(path).parent.mkdir(parents=True, exist_ok=True)
        loaders.write(default_settings_path, BASE_SETTINGS, env="default")
    settings.load_file(path=path)
    logger.info("配置文件加载成功")
